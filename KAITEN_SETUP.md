# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Kaiten API Integration

## 1. –ü–æ–ª—É—á–µ–Ω–∏–µ API —Ç–æ–∫–µ–Ω–∞

### –®–∞–≥–∏ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞:

1. –ó–∞–π–¥–∏—Ç–µ –≤ —Å–≤–æ–π –∞–∫–∫–∞—É–Ω—Ç Kaiten
2. –ù–∞–∂–º–∏—Ç–µ –Ω–∞ **–∞–≤–∞—Ç–∞—Ä–∫—É** (–ø—Ä–∞–≤—ã–π –≤–µ—Ä—Ö–Ω–∏–π —É–≥–æ–ª)
3. –í—ã–±–µ—Ä–∏—Ç–µ **"–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ"** –∏–ª–∏ **"–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ—Ñ–∏–ª—è"**
4. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ —Ä–∞–∑–¥–µ–ª **"API –∫–ª—é—á–∏"** (API Keys)
5. –ù–∞–∂–º–∏—Ç–µ **"–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –∫–ª—é—á"**
6. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ç–æ–∫–µ–Ω

**–§–æ—Ä–º–∞—Ç —Ç–æ–∫–µ–Ω–∞:** `xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx` (UUID)

### ‚ö†Ô∏è –í–∞–∂–Ω–æ:
- –¢–æ–∫–µ–Ω –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è **—Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑** –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏
- –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –µ–≥–æ –≤ –Ω–∞–¥–µ–∂–Ω–æ–º –º–µ—Å—Ç–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –º–µ–Ω–µ–¥–∂–µ—Ä –ø–∞—Ä–æ–ª–µ–π)
- **–ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–¥–∏–Ω —Ç–æ–∫–µ–Ω –¥–ª—è –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π**
- –ï—Å–ª–∏ –ø–æ—Ç–µ—Ä—è–ª–∏ —Ç–æ–∫–µ–Ω - —Å–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π

---

## 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

### –î–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ (.env.local):

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env.local` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞:

```bash
# –ë–∞–∑–æ–≤—ã–π –¥–æ–º–µ–Ω –≤–∞—à–µ–π –∫–æ–º–ø–∞–Ω–∏–∏ –≤ Kaiten (–ë–ï–ó /api/latest!)
KAITEN_API_URL=https://your-company.kaiten.ru

# –í–∞—à API —Ç–æ–∫–µ–Ω (–ë–ï–ó —Å–ª–æ–≤–∞ Bearer!)
KAITEN_API_TOKEN=xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx

# –°–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á –¥–ª—è –∑–∞—â–∏—Ç—ã —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
KAITEN_WEBHOOK_SECRET=your-random-secret-string-123
```

### –î–ª—è Vercel (Production):

1. –û—Ç–∫—Ä–æ–π—Ç–µ –≤–∞—à –ø—Ä–æ–µ–∫—Ç –Ω–∞ Vercel
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **Settings ‚Üí Environment Variables**
3. –î–æ–±–∞–≤—å—Ç–µ —Ç–µ –∂–µ 3 –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:

| Variable Name | Value | Environment |
|--------------|-------|-------------|
| `KAITEN_API_URL` | `https://your-company.kaiten.ru` | Production, Preview |
| `KAITEN_API_TOKEN` | `xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx` | Production, Preview |
| `KAITEN_WEBHOOK_SECRET` | `your-random-secret-123` | Production, Preview |

4. –ù–∞–∂–º–∏—Ç–µ **Save**
5. **Redeploy** –ø—Ä–æ–µ–∫—Ç –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π

---

## 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∞ URL

### ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ:
```bash
KAITEN_API_URL=https://my-studio.kaiten.ru
KAITEN_API_URL=https://company.kaiten.ru
```

### ‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ:
```bash
KAITEN_API_URL=https://my-studio.kaiten.ru/api/latest  # –ù–ï –¥–æ–±–∞–≤–ª—è–π—Ç–µ /api/latest!
KAITEN_API_URL=https://my-studio.kaiten.ru/api/v1      # –ù–ï –¥–æ–±–∞–≤–ª—è–π—Ç–µ /api/v1!
KAITEN_API_URL=https://my-studio.kaiten.ru/            # –ù–ï –¥–æ–±–∞–≤–ª—è–π—Ç–µ —Å–ª—ç—à –≤ –∫–æ–Ω—Ü–µ!
```

**–ü—Ä–∏—á–∏–Ω–∞:** –ö–æ–¥ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è–µ—Ç `/api/latest/` –∫ –±–∞–∑–æ–≤–æ–º—É –¥–æ–º–µ–Ω—É.

---

## 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∞ —Ç–æ–∫–µ–Ω–∞

### ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ:
```bash
KAITEN_API_TOKEN=296a5709-99bc-49a7-96e0-c0a1b236091f
```

### ‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ:
```bash
KAITEN_API_TOKEN=Bearer 296a5709-99bc-49a7-96e0-c0a1b236091f  # –ù–ï –¥–æ–±–∞–≤–ª—è–π—Ç–µ "Bearer"!
```

**–ü—Ä–∏—á–∏–Ω–∞:** –ö–æ–¥ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è–µ—Ç `Bearer` –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ `Authorization`.

---

## 5. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

–ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è:

### –õ–æ–∫–∞–ª—å–Ω–æ:
```bash
npm run dev
# –û—Ç–∫—Ä–æ–π—Ç–µ http://localhost:3000/admin/sync
```

### –ù–∞ Vercel:
```
https://your-site.vercel.app/admin/sync
```

–ü—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã:
- –ï—Å–ª–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ **–ù–ï –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã** - —É–≤–∏–¥–∏—Ç–µ –æ—à–∏–±–∫—É –≤ –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞ (F12)
- –ï—Å–ª–∏ –≤—Å—ë –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ - –∫–Ω–æ–ø–∫–∞ "–ü–æ–ª–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è" –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å

---

## 6. –ß–∞—Å—Ç—ã–µ –æ—à–∏–±–∫–∏

### –û—à–∏–±–∫–∞: "Missing Kaiten API credentials"
**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –¥–æ–±–∞–≤–∏–ª–∏ –æ–±–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ: `KAITEN_API_URL` –∏ `KAITEN_API_TOKEN`

### –û—à–∏–±–∫–∞: "KAITEN_API_URL should NOT include /api/latest"
**–†–µ—à–µ–Ω–∏–µ:** –£–±–µ—Ä–∏—Ç–µ `/api/latest` –∏–∑ URL, –æ—Å—Ç–∞–≤—å—Ç–µ —Ç–æ–ª—å–∫–æ `https://company.kaiten.ru`

### –û—à–∏–±–∫–∞: "Kaiten API Error [401]"
**–†–µ—à–µ–Ω–∏–µ:**
- –¢–æ–∫–µ–Ω –Ω–µ–≤–µ—Ä–Ω—ã–π –∏–ª–∏ —É—Å—Ç–∞—Ä–µ–ª
- –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π —Ç–æ–∫–µ–Ω –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö Kaiten
- –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –Ω–µ –¥–æ–±–∞–≤–∏–ª–∏ —Å–ª–æ–≤–æ "Bearer" –ø–µ—Ä–µ–¥ —Ç–æ–∫–µ–Ω–æ–º

### –û—à–∏–±–∫–∞: "Kaiten API Error [404]"
**–†–µ—à–µ–Ω–∏–µ:**
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å –¥–æ–º–µ–Ω–∞ –∫–æ–º–ø–∞–Ω–∏–∏
- –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ —Ä–∞–±–æ—á–∏–π –¥–æ–º–µ–Ω (–Ω–∞–ø—Ä–∏–º–µ—Ä, `my-studio.kaiten.ru`)

---

## 7. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

‚ö†Ô∏è **–ù–ò–ö–û–ì–î–ê –Ω–µ –∫–æ–º–º–∏—Ç—å—Ç–µ .env.local –≤ Git!**

–§–∞–π–ª `.env.local` —É–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω –≤ `.gitignore` –∏ –Ω–µ –ø–æ–ø–∞–¥–µ—Ç –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π.

–ï—Å–ª–∏ —Å–ª—É—á–∞–π–Ω–æ –∑–∞–∫–æ–º–º–∏—Ç–∏–ª–∏ —Ç–æ–∫–µ–Ω:
1. **–ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ** —É–¥–∞–ª–∏—Ç–µ —Ç–æ–∫–µ–Ω –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö Kaiten
2. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π —Ç–æ–∫–µ–Ω
3. –û–±–Ω–æ–≤–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

---

## 8. –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

–ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è:

1. ‚úÖ –ü—Ä–∏–º–µ–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏—é sync_metadata (–µ—Å–ª–∏ –µ—â–µ –Ω–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∞):
   ```bash
   npm run db:push
   ```

2. ‚úÖ –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø–µ—Ä–≤—É—é —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é:
   - –û—Ç–∫—Ä–æ–π—Ç–µ `/admin/sync`
   - –ù–∞–∂–º–∏—Ç–µ "üîÑ –ü–æ–ª–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è"
   - –î–æ–∂–¥–∏—Ç–µ—Å—å –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è (–º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–∏–Ω—É—Ç)

3. ‚úÖ –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
   - –û—Ç–∫—Ä–æ–π—Ç–µ Supabase Dashboard
   - –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ Table Editor ‚Üí Schema: kaiten
   - –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ —Ç–∞–±–ª–∏—Ü—ã –∑–∞–ø–æ–ª–Ω–µ–Ω—ã –¥–∞–Ω–Ω—ã–º–∏

4. üîÑ (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –≤–µ–±—Ö—É–∫–∏ –¥–ª—è real-time –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π:
   - –í –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö Kaiten –¥–æ–±–∞–≤—å—Ç–µ webhook URL: `https://your-site.vercel.app/api/webhooks/kaiten`
   - –í—ã–±–µ—Ä–∏—Ç–µ —Å–æ–±—ã—Ç–∏—è: `card.create`, `card.update`, `card.move`
   - –£–∫–∞–∂–∏—Ç–µ —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á –∏–∑ `KAITEN_WEBHOOK_SECRET`
